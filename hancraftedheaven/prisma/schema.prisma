generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  user_id   String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  firstname String         @db.VarChar(255)
  lastname  String         @db.VarChar(255)
  email     String         @unique
  password  String
  user_type user_role
  products  Product[]
  reviews   Review[]
  profile   SellerProfile?
  stories   Story[]

  @@map("users")
}

model SellerProfile {
  profile_id  String  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id     String  @unique @db.Uuid
  category    String  @db.VarChar(255)
  description String?
  image_url   String? @db.VarChar(255)
  phone       String? @db.VarChar(50)
  user        User    @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@map("seller_profile")
}

model Product {
  product_id  String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id     String   @db.Uuid
  name        String   @db.VarChar(255)
  price       Decimal  @db.Decimal(10, 2)
  description String?
  image       String?  @db.VarChar(255)
  category    String?  @db.VarChar(255)
  seller      User     @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  reviews     Review[]

  @@map("product")
}

model Review {
  review_id  String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  product_id String    @db.Uuid
  user_id    String    @db.Uuid
  rating     Int
  review     String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  product    Product   @relation(fields: [product_id], references: [product_id], onDelete: Cascade, onUpdate: NoAction)
  user       User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@map("review")
}

model Story {
  story_id   String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id    String    @db.Uuid
  content    String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  user       User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@map("stories")
}

enum user_role {
  user
  seller
  admin
}
